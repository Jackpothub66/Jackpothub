<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Mines Jackpot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a;
            --secondary: #3b82f6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #1f2937;
            --light: #f8fafc;
        }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light); padding-bottom: 100px; }
        .form-container { max-width: 450px; }
        .input-field { transition: all 0.3s ease; }
        .input-field:focus { border-color: var(--secondary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }
        .error-message { color: var(--danger); font-weight: 500; }
        .btn-primary { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); transition: all 0.3s ease; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }
        .social-btn { transition: all 0.3s ease; border: 2px solid #e5e7eb; }
        .social-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
        .floating-label { transition: all 0.3s ease; pointer-events: none; }
        .input-field:focus + .floating-label,
        .input-field:not(:placeholder-shown) + .floating-label { transform: translateY(-24px) scale(0.875); color: var(--secondary); }
    </style>
</head>
<body class="bg-slate-50">
    <nav class="bg-white shadow-md py-4 px-6 sticky top-0 z-40">
        <div class="container mx-auto flex justify-between items-center">
            <a href="index.html" class="flex items-center space-x-2">
                <i class="fas fa-bomb text-yellow-500 text-3xl"></i>
                <span class="text-xl font-bold text-blue-800">Mines Jackpot</span>
            </a>
            <div id="nav-container"></div>
        </div>
    </nav>
    
    <div class="flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="form-container w-full mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
            <div class="p-8 sm:p-10">
                <div class="text-center mb-8">
                    <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><i class="fas fa-lock text-blue-600 text-2xl"></i></div>
                    <h2 class="text-3xl font-bold text-gray-800">Welcome Back!</h2>
                    <p class="mt-2 text-gray-500">Log in to continue your gaming journey</p>
                </div>
                <form id="login-form" class="space-y-6">
                    <div class="relative">
                        <input type="email" id="email" name="email" required placeholder=" " class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none input-field peer">
                        <label for="email" class="floating-label absolute left-4 top-3 text-gray-500 bg-white px-1"><i class="fas fa-envelope mr-2"></i>Email Address</label>
                    </div>
                    <div class="relative">
                        <input type="password" id="password" name="password" required placeholder=" " class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none input-field peer">
                        <label for="password" class="floating-label absolute left-4 top-3 text-gray-500 bg-white px-1"><i class="fas fa-lock mr-2"></i>Password</label>
                    </div>
                    <div class="flex items-center justify-between">
                        <label class="flex items-center"><input type="checkbox" class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"><span class="ml-2 text-sm text-gray-600">Remember me</span></label>
                        <a href="#" id="forgot-password-link" class="text-sm text-blue-600 hover:text-blue-800 font-semibold">Forgot password?</a>
                    </div>
                    <div id="error-message" class="error-message text-center pt-2"></div>
                    <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold text-lg"><i class="fas fa-sign-in-alt mr-2"></i>Log In</button>
                </form>
                <div class="relative my-6"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="px-2 bg-white text-gray-500">Or continue with</span></div></div>
                <div class="space-y-3">
                    <button id="google-signin-btn" class="w-full social-btn bg-white py-3 rounded-lg font-semibold flex items-center justify-center"><i class="fab fa-google text-red-500 text-lg mr-3"></i>Sign in with Google</button>
                    <button id="facebook-signin-btn" class="w-full social-btn bg-white py-3 rounded-lg font-semibold flex items-center justify-center"><i class="fab fa-facebook text-blue-600 text-lg mr-3"></i>Sign in with Facebook</button>
                </div>
                <div class="mt-6 text-center"><p class="text-gray-600">Don't have an account? <a href="signup.html" class="text-blue-600 hover:text-blue-800 font-semibold">Sign up now</a></p></div>
            </div>
        </div>
    </div>
    <div id="bottom-nav-container" class="md:hidden"></div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-client.js"></script>
    <script src="auth.js"></script>
    <script>
        const loginForm = document.getElementById('login-form');
        const googleSignInBtn = document.getElementById('google-signin-btn');
        const facebookSignInBtn = document.getElementById('facebook-signin-btn');
        const errorMessageDiv = document.getElementById('error-message');
        const forgotPasswordLink = document.getElementById('forgot-password-link');

        function setLoadingState(button, isLoading) {
            if (isLoading) {
                button.disabled = true;
                button.dataset.originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Signing in...';
            } else {
                button.disabled = false;
                button.innerHTML = button.dataset.originalText;
            }
        }
        
        function showSuccessMessage() {
            // This can be a toast notification as defined in auth.js
            showToast('Login successful! Redirecting...', 'success');
        }

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            errorMessageDiv.textContent = '';
            const email = loginForm.email.value;
            const password = loginForm.password.value;
            const submitButton = loginForm.querySelector('button[type="submit"]');
            
            setLoadingState(submitButton, true);

            const { data, error } = await window.supabase.auth.signInWithPassword({
                email: email,
                password: password,
            });

            setLoadingState(submitButton, false);
            
            if (error) {
                errorMessageDiv.textContent = error.message;
            } else if (data.user) {
                showSuccessMessage();
                // onAuthStateChange in auth.js will handle the redirect to dashboard
            }
        });

        async function handleOAuthSignIn(provider) {
            const { error } = await window.supabase.auth.signInWithOAuth({ provider: provider });
            if (error) { errorMessageDiv.textContent = `Failed to sign in with ${provider}. Please try again.`; }
        }

        googleSignInBtn.addEventListener('click', () => handleOAuthSignIn('google'));
        facebookSignInBtn.addEventListener('click', () => handleOAuthSignIn('facebook'));
        
        forgotPasswordLink.addEventListener('click', async (e) => {
            e.preventDefault();
            const email = prompt('Please enter your email address to reset your password:');
            if (email) {
                const { error } = await window.supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: `${window.location.origin}/password-reset.html`,
                });
                if (error) { alert('Error sending reset email: ' + error.message); } 
                else { alert('Password reset email sent! Please check your inbox.'); }
            }
        });
    </script>
</body>
</html>