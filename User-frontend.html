<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JackpotHub — Play & Win</title>

  <!-- Tailwind (Play CDN for demo — replace with build in production) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50: '#f5f9ff', 100: '#e6f0ff', 500: '#2563eb', 700: '#1e40af' }
          }
        }
      }
    };
  </script>

  <!-- AOS for scroll animations -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
  <!-- icons -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    :root{--bg:#0b1220;--card:#0f1724;--muted:#9aa4b2}
    html,body{height:100%; scroll-behavior: smooth;}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial; background:linear-gradient(180deg,#061226 0%, #071428 100%); color:#e6eef8}
    .glass{background:rgba(255,255,255,0.03);backdrop-filter:blur(8px)}
    .brand-grad{background:linear-gradient(90deg,#2563eb,#7c3aed);background-size:200% 200%;animation:gg 6s linear infinite}
    @keyframes gg{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    .btn{transition:all .18s ease}
    .btn:hover{transform:translateY(-2px)}
    .page-fade{opacity:0;transform:translateY(8px);animation:enter .45s forwards}
    @keyframes enter{to{opacity:1;transform:none}}
    .toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: #2563eb; color: white; padding: 12px 24px; border-radius: 8px; z-index: 1000; opacity: 0; transition: all 0.4s cubic-bezier(0.21, 1.02, 0.73, 1); }
    .toast.show { opacity: 1; bottom: 20px; }
    .toast.error { background-color: #dc2626; }
    /* small responsive tweaks */
    @media (max-width:640px){ .desktop-only{display:none} }
  </style>
</head>
<body class="antialiased leading-normal">

<!-- HEADER -->
<header class="fixed w-full z-40 glass">
  <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
    <a href="#home" class="flex items-center gap-3">
      <div class="w-10 h-10 rounded-lg brand-grad flex items-center justify-center font-bold shadow text-lg">JH</div>
      <div class="hidden sm:block">
        <div class="text-lg font-semibold">JackpotHub</div>
        <div class="text-xs text-slate-400">Play • Earn • Withdraw</div>
      </div>
    </a>

    <div class="flex items-center gap-3">
      <nav class="hidden md:flex items-center gap-4">
        <a href="#games" class="text-sm">Games</a>
        <a href="#wallet" class="text-sm">Wallet</a>
        <a href="#profile" class="text-sm">Profile</a>
      </nav>
      <div id="auth-container-desktop" class="hidden md:block ml-4">
        <button onclick="toggleAuthModal(true)" class="px-3 py-2 rounded bg-brand-500 text-white btn">Sign in</button>
      </div>
      <div class="md:hidden">
        <button id="open-mobile" class="p-2 bg-white/5 rounded"><i class="fa fa-bars"></i></button>
      </div>
    </div>
  </div>
</header>

<!-- Mobile Drawer -->
<div id="mobile-drawer" class="fixed inset-0 z-50 hidden">
  <div id="drawer-bg" class="absolute inset-0 bg-black/60"></div>
  <div class="absolute left-0 top-0 bottom-0 w-72 bg-slate-900 p-6 glass">
    <button id="close-drawer" class="mb-4 p-2 rounded bg-white/5"><i class="fa fa-times"></i></button>
    <nav class="flex flex-col gap-3">
      <a href="#games" class="text-lg">Games</a>
      <a href="#wallet" class="text-lg">Wallet</a>
      <a href="#profile" class="text-lg">Profile</a>
      <div id="auth-container-mobile" class="mt-4">
          <button onclick="toggleAuthModal(true)" class="px-3 py-2 rounded bg-brand-500 w-full">Sign in</button>
      </div>
    </nav>
  </div>
</div>

<main class="pt-24 page-fade">
  <!-- HERO -->
  <section id="home" class="max-w-6xl mx-auto p-6 grid md:grid-cols-2 gap-8 items-center">
    <div data-aos="fade-right">
      <h1 class="text-4xl sm:text-5xl font-extrabold leading-tight">Play Skill Games & Turn Fun into Real Earnings</h1>
      <p class="mt-4 text-slate-400">Instant tournaments, daily rewards, and secure withdrawals — all on JackpotHub.</p>
      <div class="mt-6 flex gap-3">
        <a href="#games" class="px-5 py-3 rounded-lg bg-brand-500 btn">Play Now</a>
        <a href="#wallet" class="px-5 py-3 rounded-lg border border-white/10 btn">My Wallet</a>
      </div>
    </div>
    <div data-aos="fade-left" class="relative">
      <div class="rounded-xl overflow-hidden shadow-2xl bg-gradient-to-br from-slate-800 to-slate-900 p-6">
        <h3 class="font-semibold text-xl">Featured Games</h3>
        <p class="text-sm text-slate-400">New challenges await every day!</p>
        <div class="mt-4 grid grid-cols-3 gap-3">
          <img src="https://picsum.photos/seed/g1/300/180" class="rounded-lg object-cover shadow-lg">
          <img src="https://picsum.photos/seed/g2/300/180" class="rounded-lg object-cover shadow-lg">
          <img src="https://picsum.photos/seed/g3/300/180" class="rounded-lg object-cover shadow-lg">
        </div>
      </div>
    </div>
  </section>

  <!-- GAMES -->
  <section id="games" class="max-w-6xl mx-auto p-6">
    <h2 class="text-2xl font-semibold mb-6">Explore Our Games</h2>
    <div id="games-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Games will be rendered here by JavaScript -->
    </div>
  </section>

  <!-- WALLET -->
  <section id="wallet" class="max-w-6xl mx-auto p-6">
    <div id="wallet-view" class="hidden">
      <h2 class="text-2xl font-semibold">Wallet</h2>
      <div class="mt-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="col-span-2 p-6 glass rounded-xl">
          <div class="flex items-center justify-between">
            <div>
              <div class="text-sm text-slate-400">Available Balance</div>
              <div id="balance" class="text-3xl font-bold">₹0</div>
            </div>
          </div>
          <div class="mt-6">
            <div class="text-sm text-slate-400">Recent Transactions</div>
            <ul id="txns" class="mt-3 text-sm space-y-2"></ul>
          </div>
        </div>
        <aside class="p-6 glass rounded-xl">
          <h3 class="font-semibold">Refer & Earn</h3>
          <p class="text-sm text-slate-400 mt-2">Share your code and earn bonuses!</p>
          <div class="mt-2 p-3 bg-slate-800 rounded">Your code: <span id="ref-code" class="font-semibold tracking-widest">...</span></div>
          <button id="copy-ref" class="mt-3 px-3 py-2 rounded bg-white/5 btn">Copy Invite Link</button>
        </aside>
      </div>
    </div>
    <div id="wallet-login-prompt" class="text-center p-8 glass rounded-xl">
      <p>Please sign in to view your wallet.</p>
      <button onclick="toggleAuthModal(true)" class="mt-4 px-4 py-2 rounded bg-brand-500 btn">Sign In</button>
    </div>
  </section>

  <!-- PROFILE -->
  <section id="profile" class="max-w-6xl mx-auto p-6">
    <div id="profile-view" class="hidden">
      <h2 class="text-2xl font-semibold">Profile</h2>
      <div class="mt-4 p-6 glass rounded-xl">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
          <div class="flex items-center gap-4">
            <div id="avatar" class="w-16 h-16 rounded-full bg-slate-700 flex items-center justify-center text-xl font-bold">..</div>
            <div>
              <div id="user-name" class="font-semibold text-lg">...</div>
              <div id="member-since" class="text-sm text-slate-400">Member since ...</div>
            </div>
          </div>
          <button onclick="handleSignOut()" class="mt-4 sm:mt-0 px-4 py-2 rounded bg-red-600/50 text-white btn">Sign Out</button>
        </div>
      </div>
    </div>
    <div id="profile-login-prompt" class="text-center p-8 glass rounded-xl">
        <p>Please sign in to view your profile.</p>
        <button onclick="toggleAuthModal(true)" class="mt-4 px-4 py-2 rounded bg-brand-500 btn">Sign In</button>
    </div>
  </section>

  <footer class="max-w-6xl mx-auto p-6 text-center text-slate-400">© JackpotHub — All Rights Reserved</footer>
</main>

<!-- PLAY MODAL -->
<div id="play-modal" class="fixed inset-0 hidden items-center justify-center z-50 bg-black/60">
  <div class="w-full max-w-lg bg-slate-900 rounded-xl p-6">
    <div class="flex items-center justify-between"><div><h3 id="play-title" class="font-semibold text-lg">Game</h3><div id="play-sub" class="text-sm text-slate-400"></div></div><button id="close-play" class="px-3 py-1 rounded bg-white/5">&times;</button></div>
    <div class="mt-4 bg-black rounded-lg aspect-video flex items-center justify-center text-slate-400">
        <div id="play-status" class="text-2xl font-bold text-center p-4"></div>
    </div>
    <div class="mt-4"><button id="play-buy" class="w-full px-4 py-3 rounded bg-brand-500 btn font-bold">Play for ₹10</button></div>
  </div>
</div>

<!-- AUTH MODAL -->
<div id="auth-modal" class="fixed inset-0 hidden items-center justify-center z-50 bg-black/60">
  <div class="w-full max-w-md bg-slate-900 rounded-xl p-6 relative">
    <h3 id="auth-title" class="font-semibold text-xl">Sign in</h3>
    <form id="auth-form" class="mt-4 grid gap-3">
      <input id="auth-name" placeholder="Full Name" class="p-3 bg-slate-800 rounded hidden" required>
      <input id="auth-email" placeholder="Email" type="email" class="p-3 bg-slate-800 rounded" required>
      <input id="auth-pass" placeholder="Password" type="password" class="p-3 bg-slate-800 rounded" required>
      <div class="flex gap-3"><button id="auth-submit-btn" class="px-4 py-2 rounded bg-brand-500 btn">Sign in</button><button id="auth-toggle-btn" type="button" class="px-4 py-2 rounded bg-white/5 btn">Need an account? Register</button></div>
    </form>
    <button onclick="toggleAuthModal(false)" class="absolute top-3 right-4 text-slate-400 text-2xl hover:text-white">&times;</button>
  </div>
</div>

<!-- SCRIPTS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
<script>
  AOS.init({ duration: 600, once: true });

  const API_URL = '/api';
  let appState = {
    isAuthenticated: false,
    currentUser: null,
    games: []
  };

  const DOMElements = {
    authModal: document.getElementById('auth-modal'),
    authForm: document.getElementById('auth-form'),
    authTitle: document.getElementById('auth-title'),
    authNameInput: document.getElementById('auth-name'),
    authSubmitBtn: document.getElementById('auth-submit-btn'),
    authToggleBtn: document.getElementById('auth-toggle-btn'),
    playModal: document.getElementById('play-modal'),
    playTitle: document.getElementById('play-title'),
    playSub: document.getElementById('play-sub'),
    playBuyBtn: document.getElementById('play-buy'),
    playStatus: document.getElementById('play-status'),
  };
  
  function showToast(message, isError = false) {
    const toast = document.createElement('div');
    toast.className = `toast ${isError ? 'error' : ''}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.classList.add('show');
        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => document.body.removeChild(toast), 400);
        }, 3000);
    }, 10);
  }

  async function renderGames() {
    const grid = document.getElementById('games-grid');
    grid.innerHTML = '<div class="text-center col-span-full p-8 text-slate-400">Loading Games...</div>';
    try {
      const response = await fetch(`${API_URL}/games`);
      if (!response.ok) throw new Error('Failed to load games');
      appState.games = await response.json();
      
      if(appState.games.length === 0) {
        grid.innerHTML = '<div class="text-center col-span-full p-8 text-slate-400">No games available right now.</div>';
        return;
      }

      grid.innerHTML = '';
      appState.games.forEach(g => {
        const el = document.createElement('div');
        el.className = 'bg-slate-800 rounded-xl overflow-hidden shadow hover:scale-[1.02] transition';
        el.innerHTML = `
          <img src="${g.img}" class="w-full h-44 object-cover">
          <div class="p-4">
            <div class="flex items-center justify-between">
              <div>
                <div class="font-semibold">${g.title}</div>
                <div class="text-xs text-slate-400">Bet ₹${g.bet} • ${g.type}</div>
              </div>
              <button data-id="${g._id}" class="btn-play px-4 py-2 rounded bg-brand-500 text-sm btn">Play</button>
            </div>
          </div>`;
        grid.appendChild(el);
      });
      document.querySelectorAll('.btn-play').forEach(b => b.addEventListener('click', e => openPlayModal(e.target.dataset.id)));
    } catch (error) {
      grid.innerHTML = `<div class="text-center col-span-full p-8 text-red-400">${error.message}</div>`;
    }
  }

  async function renderWalletAndProfile() {
    if (!appState.isAuthenticated) return;
    try {
        const res = await fetch(`${API_URL}/user/${appState.currentUser._id}`);
        if (!res.ok) throw new Error('Could not fetch user data');
        const { user, transactions } = await res.json();
        
        document.getElementById('balance').innerText = `₹${user.wallet.toLocaleString()}`;
        document.getElementById('ref-code').innerText = `JH-${user._id.slice(-6).toUpperCase()}`;
        
        const txnsList = document.getElementById('txns');
        txnsList.innerHTML = transactions.length > 0
            ? transactions.map(t => `<li class="flex justify-between items-center py-1 border-b border-slate-700/50 ${t.amount > 0 ? 'text-green-400' : 'text-slate-300'}"><span class="capitalize">${t.type}</span> <span class="font-mono">${t.amount > 0 ? '+' : ''}₹${t.amount.toLocaleString()}</span></li>`).join('')
            : '<li>No recent transactions.</li>';

        document.getElementById('avatar').innerText = user.name.substring(0, 2).toUpperCase();
        document.getElementById('user-name').innerText = user.name;
        const joinDate = new Date(user.memberSince).toLocaleDateString('en-IN', { year: 'numeric', month: 'long' });
        document.getElementById('member-since').innerText = `Member since ${joinDate}`;

    } catch (error) {
        showToast(error.message, true);
        if (error.message.includes('fetch')) handleSignOut(); // Auto sign out if session is invalid
    }
  }

  function updateUI() {
    const loggedIn = appState.isAuthenticated;
    const authDesktop = document.getElementById('auth-container-desktop');
    const authMobile = document.getElementById('auth-container-mobile');

    if (loggedIn) {
        const userName = appState.currentUser.name.split(' ')[0];
        authDesktop.innerHTML = `<a href="#profile" class="px-3 py-2 rounded bg-white/5 btn">Profile (${userName})</a>`;
        authMobile.innerHTML = `<a href="#profile" class="px-3 py-2 rounded bg-white/5 w-full block text-center">Profile</a>`;
        renderWalletAndProfile();
    } else {
        authDesktop.innerHTML = `<button onclick="toggleAuthModal(true)" class="px-3 py-2 rounded bg-brand-500 text-white btn">Sign in</button>`;
        authMobile.innerHTML = `<button onclick="toggleAuthModal(true)" class="px-3 py-2 rounded bg-brand-500 w-full">Sign in</button>`;
    }

    ['wallet', 'profile'].forEach(id => {
        document.getElementById(`${id}-view`).style.display = loggedIn ? '' : 'block';
        document.getElementById(`${id}-login-prompt`).style.display = loggedIn ? 'none' : 'block';
    });
  }

  function openPlayModal(id) {
    if (!appState.isAuthenticated) {
        showToast('Please sign in to play!', true);
        toggleAuthModal(true);
        return;
    }
    const game = appState.games.find(x => x._id === id);
    if (!game) return;
    
    DOMElements.playTitle.innerText = game.title;
    DOMElements.playSub.innerText = `${game.type} • Bet ₹${game.bet}`;
    DOMElements.playBuyBtn.innerText = `Play for ₹${game.bet}`;
    DOMElements.playBuyBtn.dataset.id = id;
    DOMElements.playStatus.innerText = 'Ready to play!';
    DOMElements.playBuyBtn.disabled = false;
    DOMElements.playModal.classList.remove('hidden');
    DOMElements.playModal.classList.add('flex');
  }
  document.getElementById('close-play').addEventListener('click', () => DOMElements.playModal.classList.add('hidden'));
  
  async function handlePlayGame(e) {
      const gameId = e.target.dataset.id;
      e.target.disabled = true;
      DOMElements.playStatus.innerText = 'Playing...';
      
      try {
          const res = await fetch(`${API_URL}/play/${gameId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ userId: appState.currentUser._id })
          });
          const result = await res.json();
          if(!res.ok) throw new Error(result.error);

          if (result.outcome === 'win') {
              DOMElements.playStatus.innerText = `You won ₹${result.winnings}!`;
              showToast(`Congratulations! You won ₹${result.winnings}!`);
          } else {
              DOMElements.playStatus.innerText = 'Better luck next time!';
          }
          await renderWalletAndProfile();
      } catch(error) {
          DOMElements.playStatus.innerText = 'Error!';
          showToast(error.message, true);
      }
      e.target.disabled = false;
  }
  DOMElements.playBuyBtn.addEventListener('click', handlePlayGame);

  let isRegisterMode = false;
  function toggleAuthModal(show, registerMode = false) {
    DOMElements.authModal.classList.toggle('hidden', !show);
    DOMElements.authModal.classList.toggle('flex', show);
    isRegisterMode = registerMode;
    
    DOMElements.authTitle.innerText = isRegisterMode ? 'Create Account' : 'Sign in';
    DOMElements.authNameInput.classList.toggle('hidden', !isRegisterMode);
    DOMElements.authSubmitBtn.innerText = isRegisterMode ? 'Register' : 'Sign in';
    DOMElements.authToggleBtn.innerText = isRegisterMode ? 'Have an account? Sign in' : 'Need an account? Register';
    DOMElements.authForm.reset();
  }
  DOMElements.authToggleBtn.addEventListener('click', () => toggleAuthModal(true, !isRegisterMode));
  
  DOMElements.authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      DOMElements.authSubmitBtn.disabled = true;
      DOMElements.authSubmitBtn.innerText = 'Processing...';
      
      const email = DOMElements.authForm.elements['auth-email'].value;
      const password = DOMElements.authForm.elements['auth-pass'].value;
      const endpoint = isRegisterMode ? '/register' : '/login';
      const body = isRegisterMode 
        ? { name: DOMElements.authForm.elements['auth-name'].value, email, password } 
        : { email, password };

      try {
        const response = await fetch(`${API_URL}${endpoint}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body)
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error);

        if(isRegisterMode){
            showToast('Registration successful! Please sign in.');
            toggleAuthModal(true, false);
        } else {
            appState.isAuthenticated = true;
            appState.currentUser = result;
            localStorage.setItem('jackpotHubUser', JSON.stringify(result));
            showToast(`Welcome, ${result.name}!`);
            toggleAuthModal(false);
            updateUI();
        }
      } catch (error) {
        showToast(error.message, true);
      }
      DOMElements.authSubmitBtn.disabled = false;
      DOMElements.authSubmitBtn.innerText = isRegisterMode ? 'Register' : 'Sign in';
  });

  function handleSignOut() {
    appState.isAuthenticated = false;
    appState.currentUser = null;
    localStorage.removeItem('jackpotHubUser');
    showToast('You have been signed out.');
    updateUI();
  }

  document.getElementById('copy-ref').addEventListener('click', () => {
      const refCode = document.getElementById('ref-code').innerText;
      const inviteLink = `${window.location.origin}?ref=${refCode}`;
      navigator.clipboard.writeText(inviteLink).then(() => {
          showToast('Invite link copied!');
      });
  });

  const mobileDrawer = document.getElementById('mobile-drawer');
  document.getElementById('open-mobile').addEventListener('click', () => mobileDrawer.classList.remove('hidden'));
  document.getElementById('close-drawer').addEventListener('click', () => mobileDrawer.classList.add('hidden'));
  document.getElementById('drawer-bg').addEventListener('click', () => mobileDrawer.classList.add('hidden'));
  mobileDrawer.querySelectorAll('a').forEach(link => link.addEventListener('click', () => mobileDrawer.classList.add('hidden')));

  function initializeApp() {
    const savedUser = localStorage.getItem('jackpotHubUser');
    if (savedUser) {
        appState.isAuthenticated = true;
        appState.currentUser = JSON.parse(savedUser);
    }
    renderGames();
    updateUI();
  }
  initializeApp();
</script>
</body>
</html>